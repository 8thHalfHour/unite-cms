#!/bin/bash

set -e

mkdir /tmp/sessions
mkdir /run/php-fpm
mkdir /var/log/supervisor

chown -R 1001:0 /tmp/sessions
chown -R 1001:0 /app

mkdir -p /var/lib/nginx && \
mkdir -p /var/log/nginx && \
touch /var/log/nginx/error.log && \
touch /var/log/nginx/access.log && \
chown -R 1001:0 /var/log/supervisor && \
chown -R 1001:0 /var/log/nginx && \
chown -R 1001:0 /var/lib/nginx && \
chown -R 1001:0 /run/php-fpm && \
chown -R 1001:0 /var/run && \
chmod -R a+rwx /tmp/sessions && \
chmod -R a+rwx /var/log/nginx && \
chmod -R a+rwx /var/lib/nginx && \
chmod -R a+rwx /var/log/supervisor && \
chmod -R a+rwx /run/php-fpm && \
chmod -R ug+rwx /var/log/nginx && \
chmod -R ug+rwx /var/lib/nginx && \
chmod -R 777 /app && \
fix-permissions /etc/php.ini && \
fix-permissions /etc/php-fpm.conf && \
fix-permissions /etc/php-fpm.d/ && \
fix-permissions /run/php-fpm && \
fix-permissions /var/lib/php/session/ && \
fix-permissions /etc/nginx/ && \
fix-permissions /var/log/nginx/ && \
fix-permissions /var/lib/nginx/ && \
fix-permissions /run/